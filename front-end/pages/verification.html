<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="verification.meta.title">é‚®ç®±éªŒè¯ - å­¦ç”Ÿæ¸¯æ¹¾</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/pages/register.css">
</head>
<body data-nav-active="profile">
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header id="siteHeader"></header>

    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <div class="container">
            <div class="register-container">
                <div class="register-card">
                    <div class="register-header">
                        <h1 class="register-title" data-i18n-key="verification.hero.title">é‚®ç®±éªŒè¯</h1>
                        <p class="register-subtitle" data-i18n-key="verification.hero.subtitle">è¯·éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€ä»¥å®Œæˆæ³¨å†Œ</p>
                    </div>

                    <div id="verificationContent">
                        <!-- å¼€å‘æ¨¡å¼æç¤ºï¼ˆä»…åœ¨å‰ç«¯æµ‹è¯•æ—¶æ˜¾ç¤ºï¼‰ -->
                        <div id="devModeNotice" class="dev-mode-notice" style="display: none;">
                            <div class="notice-title">
                                <span>ğŸ”§</span>
                                <span data-i18n-key="verification.devMode.title">å¼€å‘æ¨¡å¼ - æµ‹è¯•éªŒè¯</span>
                            </div>
                            <div class="notice-content">
                                <p style="margin-bottom: 8px;" data-i18n-key="verification.devMode.description">å½“å‰ä¸ºå‰ç«¯å¼€å‘æ¨¡å¼ï¼Œæ— æ³•å‘é€çœŸå®é‚®ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•é“¾æ¥æ¥æ¨¡æ‹ŸéªŒè¯æµç¨‹ï¼š</p>
                                <p style="margin-bottom: 8px;"><strong data-i18n-key="verification.devMode.linkLabel">æµ‹è¯•éªŒè¯é“¾æ¥ï¼š</strong></p>
                                <a href="#" id="testVerificationLink" class="dev-link" data-i18n-key="verification.devMode.linkText">ç‚¹å‡»è¿™é‡Œæ¨¡æ‹ŸéªŒè¯æˆåŠŸ</a>
                                <p style="margin-top: 12px; font-size: 12px; color: var(--text-secondary);" data-i18n-key="verification.devMode.hint">
                                    ğŸ’¡ æç¤ºï¼šåœ¨å®é™…éƒ¨ç½²åï¼Œç”¨æˆ·ä¼šæ”¶åˆ°åŒ…å«éªŒè¯é“¾æ¥çš„çœŸå®é‚®ä»¶ã€‚
                                </p>
                            </div>
                        </div>

                        <!-- ç­‰å¾…éªŒè¯çŠ¶æ€ -->
                        <div id="pendingState" class="text-center">
                            <div style="font-size: 64px; margin-bottom: 24px;">ğŸ“§</div>
                            <h2 style="margin-bottom: 16px;" data-i18n-key="verification.pending.title">éªŒè¯é‚®ä»¶å·²å‘é€</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 24px;">
                                <span data-i18n-key="verification.pending.sentPrefix">æˆ‘ä»¬å·²å‘</span> <strong id="verificationEmail"></strong> <span data-i18n-key="verification.pending.sentSuffix">å‘é€äº†éªŒè¯é‚®ä»¶</span>
                            </p>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;" data-i18n-key="verification.pending.instruction">
                                è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±å¹¶ç‚¹å‡»éªŒè¯é“¾æ¥ã€‚å¦‚æœæœªæ”¶åˆ°é‚®ä»¶ï¼Œè¯·æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ã€‚
                            </p>
                            <button class="btn btn-secondary" id="resendBtn" data-i18n-key="verification.pending.resend">é‡æ–°å‘é€éªŒè¯é‚®ä»¶</button>
                        </div>

                        <!-- éªŒè¯æˆåŠŸçŠ¶æ€ -->
                        <div id="successState" class="hidden text-center">
                            <div style="font-size: 64px; margin-bottom: 24px; color: var(--success-color);">âœ“</div>
                            <h2 style="margin-bottom: 16px; color: var(--success-color);" data-i18n-key="verification.success.title">éªŒè¯æˆåŠŸï¼</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;" data-i18n-key="verification.success.message">
                                æ‚¨çš„é‚®ç®±å·²éªŒè¯æˆåŠŸï¼Œç°åœ¨å¯ä»¥äº«å—å®Œæ•´åŠŸèƒ½äº†ã€‚
                            </p>
                            <a href="login.html" class="btn btn-primary" data-i18n-key="verification.success.goLogin">å‰å¾€ç™»å½•</a>
                        </div>

                        <!-- éªŒè¯å¤±è´¥çŠ¶æ€ -->
                        <div id="errorState" class="hidden text-center">
                            <div style="font-size: 64px; margin-bottom: 24px; color: var(--error-color);">âœ—</div>
                            <h2 style="margin-bottom: 16px; color: var(--error-color);" data-i18n-key="verification.error.title">éªŒè¯å¤±è´¥</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;" id="errorMessage" data-i18n-key="verification.error.defaultMessage">
                                éªŒè¯é“¾æ¥æ— æ•ˆæˆ–å·²è¿‡æœŸã€‚
                            </p>
                            <button class="btn btn-primary" id="retryBtn" data-i18n-key="verification.error.retry">é‡æ–°å‘é€éªŒè¯é‚®ä»¶</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p data-i18n-key="common.footer.default">&copy; 2024 å­¦ç”Ÿæ¸¯æ¹¾. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/utils/i18n.data.js"></script>
    <script src="../js/utils/i18n.js"></script>
    <script src="../js/utils/auth.js"></script>
    <script src="../js/utils/navbar.js"></script>
    <script src="../js/utils/api.js"></script>
    <script src="../js/utils/navigation.js"></script>
    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // åˆå§‹åŒ–éªŒè¯é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            const email = getUrlParameter('email');
            const token = getUrlParameter('token');
            
            if (email) {
                document.getElementById('verificationEmail').textContent = email;
            }
            
            // å¼€å‘æ¨¡å¼ï¼šå¦‚æœæ²¡æœ‰tokenï¼Œæ˜¾ç¤ºæµ‹è¯•å·¥å…·
            if (!token) {
                showDevModeNotice(email);
            }
            
            // å¦‚æœæœ‰tokenï¼Œå°è¯•éªŒè¯
            if (token) {
                verifyEmail(token);
            }
            
            // é‡æ–°å‘é€éªŒè¯é‚®ä»¶
            document.getElementById('resendBtn').addEventListener('click', async function() {
                if (!email) {
                    alert(I18n.t('verification.alert.noEmail', 'æ— æ³•è·å–é‚®ç®±åœ°å€'));
                    return;
                }
                
                this.disabled = true;
                this.textContent = I18n.t('verification.pending.sending', 'å‘é€ä¸­...');
                
                try {
                    // è°ƒç”¨APIï¼ˆé¢„ç•™åç«¯ï¼‰
                    // await UserAPI.sendVerificationEmail(email);
                    
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    setTimeout(() => {
                        alert(I18n.t('verification.alert.resendSuccess', 'éªŒè¯é‚®ä»¶å·²é‡æ–°å‘é€ï¼'));
                        this.disabled = false;
                        this.textContent = I18n.t('verification.pending.resend', 'é‡æ–°å‘é€éªŒè¯é‚®ä»¶');
                    }, 1000);
                } catch (error) {
                    alert(I18n.t('verification.alert.resendFailed', 'å‘é€å¤±è´¥: {error}', { error: error.message || I18n.t('common.error.unknown', 'æœªçŸ¥é”™è¯¯') }));
                    this.disabled = false;
                    this.textContent = I18n.t('verification.pending.resend', 'é‡æ–°å‘é€éªŒè¯é‚®ä»¶');
                }
            });
            
            // é‡è¯•æŒ‰é’®
            document.getElementById('retryBtn').addEventListener('click', function() {
                if (email) {
                    window.location.href = `verification.html?email=${encodeURIComponent(email)}`;
                } else {
                    window.location.href = 'register.html';
                }
            });
            
            // æµ‹è¯•éªŒè¯é“¾æ¥ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
            const testLink = document.getElementById('testVerificationLink');
            if (testLink) {
                testLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    // æ¨¡æ‹ŸéªŒè¯æˆåŠŸ
                    const testToken = 'test_token_' + Date.now();
                    verifyEmail(testToken);
                });
            }
        });
        
        // æ˜¾ç¤ºå¼€å‘æ¨¡å¼æç¤º
        function showDevModeNotice(email) {
            const notice = document.getElementById('devModeNotice');
            if (notice) {
                notice.style.display = 'block';
            }
        }
        
        // éªŒè¯é‚®ç®±
        async function verifyEmail(token) {
            try {
                // è°ƒç”¨APIï¼ˆé¢„ç•™åç«¯ï¼‰
                // const response = await UserAPI.verifyEmail(token);
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                    document.getElementById('pendingState').classList.add('hidden');
                    document.getElementById('errorState').classList.add('hidden');
                    document.getElementById('successState').classList.remove('hidden');
                }, 1000);
            } catch (error) {
                // æ˜¾ç¤ºå¤±è´¥çŠ¶æ€
                document.getElementById('pendingState').classList.add('hidden');
                document.getElementById('successState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = error.message || I18n.t('verification.error.defaultMessage', 'éªŒè¯å¤±è´¥');
            }
        }
    </script>
</body>
</html>

