<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‚®ç®±éªŒè¯ - å­¦ç”Ÿæ¸¯æ¹¾</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/pages/register.css">
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="../index.html" class="logo">å­¦ç”Ÿæ¸¯æ¹¾</a>
                <nav class="nav">
                    <a href="../index.html" class="nav-link">é¦–é¡µ</a>
                    <a href="items.html" class="nav-link">æµè§ˆå®è´</a>
                    <a href="login.html" class="nav-link" id="loginLink">ç™»å½•</a>
                    <a href="register.html" class="nav-link" id="registerLink">æ³¨å†Œ</a>
                    <a href="profile.html" class="nav-link" id="profileLink" style="display: none;">ä¸ªäººèµ„æ–™</a>
                    <div class="nav-dropdown" style="display: none;">
                        <a href="profile.html" class="nav-link">ä¸ªäººä¸­å¿ƒ â–¾</a>
                        <div class="dropdown-menu">
                            <a href="my-items.html" class="dropdown-item">æˆ‘çš„å®è´</a>
                            <a href="post-item.html" class="dropdown-item">å‘å¸ƒç‰©å“</a>
                        </div>
                    </div>
                    <a href="#" class="nav-link" id="logoutLink" style="display: none;">é€€å‡ºç™»å½•</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <div class="container">
            <div class="register-container">
                <div class="register-card">
                    <div class="register-header">
                        <h1 class="register-title">é‚®ç®±éªŒè¯</h1>
                        <p class="register-subtitle">è¯·éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€ä»¥å®Œæˆæ³¨å†Œ</p>
                    </div>

                    <div id="verificationContent">
                        <!-- å¼€å‘æ¨¡å¼æç¤ºï¼ˆä»…åœ¨å‰ç«¯æµ‹è¯•æ—¶æ˜¾ç¤ºï¼‰ -->
                        <div id="devModeNotice" class="dev-mode-notice" style="display: none;">
                            <div class="notice-title">
                                <span>ğŸ”§</span>
                                <span>å¼€å‘æ¨¡å¼ - æµ‹è¯•éªŒè¯</span>
                            </div>
                            <div class="notice-content">
                                <p style="margin-bottom: 8px;">å½“å‰ä¸ºå‰ç«¯å¼€å‘æ¨¡å¼ï¼Œæ— æ³•å‘é€çœŸå®é‚®ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•é“¾æ¥æ¥æ¨¡æ‹ŸéªŒè¯æµç¨‹ï¼š</p>
                                <p style="margin-bottom: 8px;"><strong>æµ‹è¯•éªŒè¯é“¾æ¥ï¼š</strong></p>
                                <a href="#" id="testVerificationLink" class="dev-link">ç‚¹å‡»è¿™é‡Œæ¨¡æ‹ŸéªŒè¯æˆåŠŸ</a>
                                <p style="margin-top: 12px; font-size: 12px; color: var(--text-secondary);">
                                    ğŸ’¡ æç¤ºï¼šåœ¨å®é™…éƒ¨ç½²åï¼Œç”¨æˆ·ä¼šæ”¶åˆ°åŒ…å«éªŒè¯é“¾æ¥çš„çœŸå®é‚®ä»¶ã€‚
                                </p>
                            </div>
                        </div>

                        <!-- ç­‰å¾…éªŒè¯çŠ¶æ€ -->
                        <div id="pendingState" class="text-center">
                            <div style="font-size: 64px; margin-bottom: 24px;">ğŸ“§</div>
                            <h2 style="margin-bottom: 16px;">éªŒè¯é‚®ä»¶å·²å‘é€</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 24px;">
                                æˆ‘ä»¬å·²å‘ <strong id="verificationEmail"></strong> å‘é€äº†éªŒè¯é‚®ä»¶
                            </p>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;">
                                è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±å¹¶ç‚¹å‡»éªŒè¯é“¾æ¥ã€‚å¦‚æœæœªæ”¶åˆ°é‚®ä»¶ï¼Œè¯·æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ã€‚
                            </p>
                            <button class="btn btn-secondary" id="resendBtn">é‡æ–°å‘é€éªŒè¯é‚®ä»¶</button>
                        </div>

                        <!-- éªŒè¯æˆåŠŸçŠ¶æ€ -->
                        <div id="successState" class="hidden text-center">
                            <div style="font-size: 64px; margin-bottom: 24px; color: var(--success-color);">âœ“</div>
                            <h2 style="margin-bottom: 16px; color: var(--success-color);">éªŒè¯æˆåŠŸï¼</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;">
                                æ‚¨çš„é‚®ç®±å·²éªŒè¯æˆåŠŸï¼Œç°åœ¨å¯ä»¥äº«å—å®Œæ•´åŠŸèƒ½äº†ã€‚
                            </p>
                            <a href="login.html" class="btn btn-primary">å‰å¾€ç™»å½•</a>
                        </div>

                        <!-- éªŒè¯å¤±è´¥çŠ¶æ€ -->
                        <div id="errorState" class="hidden text-center">
                            <div style="font-size: 64px; margin-bottom: 24px; color: var(--error-color);">âœ—</div>
                            <h2 style="margin-bottom: 16px; color: var(--error-color);">éªŒè¯å¤±è´¥</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 32px;" id="errorMessage">
                                éªŒè¯é“¾æ¥æ— æ•ˆæˆ–å·²è¿‡æœŸã€‚
                            </p>
                            <button class="btn btn-primary" id="retryBtn">é‡æ–°å‘é€éªŒè¯é‚®ä»¶</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 å­¦ç”Ÿæ¸¯æ¹¾. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/utils/auth.js"></script>
    <script src="../js/utils/api.js"></script>
    <script src="../js/utils/navigation.js"></script>
    <script>
        // é€€å‡ºç™»å½•
        document.addEventListener('DOMContentLoaded', function() {
            updateNavigation();
            
            const logoutLink = document.getElementById('logoutLink');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        clearAuth();
                        updateNavigation();
                        window.location.href = '../index.html';
                    }
                });
            }
        });
    </script>
    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // åˆå§‹åŒ–éªŒè¯é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            const email = getUrlParameter('email');
            const token = getUrlParameter('token');
            
            if (email) {
                document.getElementById('verificationEmail').textContent = email;
            }
            
            // å¼€å‘æ¨¡å¼ï¼šå¦‚æœæ²¡æœ‰tokenï¼Œæ˜¾ç¤ºæµ‹è¯•å·¥å…·
            if (!token) {
                showDevModeNotice(email);
            }
            
            // å¦‚æœæœ‰tokenï¼Œå°è¯•éªŒè¯
            if (token) {
                verifyEmail(token);
            }
            
            // é‡æ–°å‘é€éªŒè¯é‚®ä»¶
            document.getElementById('resendBtn').addEventListener('click', async function() {
                if (!email) {
                    alert('æ— æ³•è·å–é‚®ç®±åœ°å€');
                    return;
                }
                
                this.disabled = true;
                this.textContent = 'å‘é€ä¸­...';
                
                try {
                    // è°ƒç”¨APIï¼ˆé¢„ç•™åç«¯ï¼‰
                    // await UserAPI.sendVerificationEmail(email);
                    
                    // æ¨¡æ‹ŸAPIè°ƒç”¨
                    setTimeout(() => {
                        alert('éªŒè¯é‚®ä»¶å·²é‡æ–°å‘é€ï¼');
                        this.disabled = false;
                        this.textContent = 'é‡æ–°å‘é€éªŒè¯é‚®ä»¶';
                    }, 1000);
                } catch (error) {
                    alert('å‘é€å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                    this.disabled = false;
                    this.textContent = 'é‡æ–°å‘é€éªŒè¯é‚®ä»¶';
                }
            });
            
            // é‡è¯•æŒ‰é’®
            document.getElementById('retryBtn').addEventListener('click', function() {
                if (email) {
                    window.location.href = `verification.html?email=${encodeURIComponent(email)}`;
                } else {
                    window.location.href = 'register.html';
                }
            });
            
            // æµ‹è¯•éªŒè¯é“¾æ¥ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
            const testLink = document.getElementById('testVerificationLink');
            if (testLink) {
                testLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    // æ¨¡æ‹ŸéªŒè¯æˆåŠŸ
                    const testToken = 'test_token_' + Date.now();
                    verifyEmail(testToken);
                });
            }
        });
        
        // æ˜¾ç¤ºå¼€å‘æ¨¡å¼æç¤º
        function showDevModeNotice(email) {
            const notice = document.getElementById('devModeNotice');
            if (notice) {
                notice.style.display = 'block';
            }
        }
        
        // éªŒè¯é‚®ç®±
        async function verifyEmail(token) {
            try {
                // è°ƒç”¨APIï¼ˆé¢„ç•™åç«¯ï¼‰
                // const response = await UserAPI.verifyEmail(token);
                
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                setTimeout(() => {
                    // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                    document.getElementById('pendingState').classList.add('hidden');
                    document.getElementById('errorState').classList.add('hidden');
                    document.getElementById('successState').classList.remove('hidden');
                }, 1000);
            } catch (error) {
                // æ˜¾ç¤ºå¤±è´¥çŠ¶æ€
                document.getElementById('pendingState').classList.add('hidden');
                document.getElementById('successState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = error.message || 'éªŒè¯å¤±è´¥';
            }
        }
    </script>
</body>
</html>

